#!/usr/bin/env sh

envpath="$PWD/.envrc"

if [ -f "$envpath" ]; then
	echo >&2 "There already is a direnv config file at '$envpath'."
	exit 1
fi

if [ -f "shell.nix" ]; then
	echo "use nix" >> "$envpath"
fi
if [ -f "flake.nix" ]; then
	echo "use flake" >> "$envpath"
fi

if [ -f "Pipfile" ]; then
	echo "layout pipenv" >> "$envpath"
fi
if [ -f "pyproject.toml" ] && grep -q "poetry" "pyproject.toml"; then
	echo "layout poetry" >> "$envpath"
fi

if [ ! -s "$envpath" ]; then
	echo >&2 "No environment files were recognized, aborting."
	exit 1
fi
echo "Created direnv config file at '$envpath'."

direnv allow "$envpath"
direnv reload
