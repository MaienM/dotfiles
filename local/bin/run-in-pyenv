#!/usr/bin/env sh

# Usage in shebang:
#!/usr/bin/env -S run-in-pyenv <version|virtualenv> python

if ! command -v pyenv > /dev/null 2>&1; then
	echo >&2 "Pyenv not found, aborting."
	exit 1
fi

pyversion="$1"
command="$2"
shift 2

path="$(PYENV_VERSION="$pyversion" pyenv which "$command")"
if [ -z "$path" ] || [ "$path" = "$(command -v "$command")" ]; then
	echo >&2 "Command '$command' not found in pyenv version '$pyversion'."
	exit 1
fi

exec "$path" "$@"

